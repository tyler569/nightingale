.TH MALLOC 3 "2025" "Nightingale" "Nightingale Library Functions"
.SH NAME
malloc, free, calloc, realloc \- allocate and free dynamic memory
.SH SYNOPSIS
.nf
.B #include <stdlib.h>
.PP
.BI "void *malloc(size_t " size ");"
.BI "void free(void *" ptr ");"
.BI "void *calloc(size_t " nmemb ", size_t " size ");"
.BI "void *realloc(void *" ptr ", size_t " size ");"
.fi
.SH DESCRIPTION
.SS malloc()
The
.BR malloc ()
function allocates
.I size
bytes and returns a pointer to the allocated memory.
The memory is not initialized.
If
.I size
is 0, then
.BR malloc ()
returns either NULL, or a unique pointer value that can later be successfully
passed to
.BR free ().
.SS free()
The
.BR free ()
function frees the memory space pointed to by
.IR ptr ,
which must have been returned by a previous call to
.BR malloc (),
.BR calloc (),
or
.BR realloc ().
Otherwise, or if
.I free(ptr)
has already been called before, undefined behavior occurs.
If
.I ptr
is NULL, no operation is performed.
.SS calloc()
The
.BR calloc ()
function allocates memory for an array of
.I nmemb
elements of
.I size
bytes each and returns a pointer to the allocated memory.
The memory is set to zero.
If
.I nmemb
or
.I size
is 0, then
.BR calloc ()
returns either NULL, or a unique pointer value that can later be
successfully passed to
.BR free ().
.SS realloc()
The
.BR realloc ()
function changes the size of the memory block pointed to by
.I ptr
to
.I size
bytes.
The contents will be unchanged in the range from the start of the region
up to the minimum of the old and new sizes.
If the new size is larger than the old size, the added memory will
.I not
be initialized.
If
.I ptr
is NULL,
then the call is equivalent to
.IR malloc(size) ,
for all values of
.IR size ;
if
.I size
is equal to zero,
and
.I ptr
is not NULL, then the call is equivalent to
.IR free(ptr) .
.SH RETURN VALUE
The
.BR malloc ()
and
.BR calloc ()
functions return a pointer to the allocated memory,
which is suitably aligned for any built-in type.
On error, these functions return NULL.
NULL may also be returned by a successful call to
.BR malloc ()
with a
.I size
of zero,
or by a successful call to
.BR calloc ()
with
.I nmemb
or
.I size
equal to zero.
.PP
The
.BR free ()
function returns no value.
.PP
The
.BR realloc ()
function returns a pointer to the newly allocated memory, which is suitably
aligned for any built-in type, or NULL if the request failed.
The returned pointer may be the same as
.IR ptr
if the allocation was not moved (e.g., there was room to expand the
allocation in-place), or different from
.IR ptr
if the allocation was moved to a new address.
If
.I size
was equal to 0, either NULL or a pointer suitable to be passed to
.BR free ()
is returned.
If
.BR realloc ()
fails, the original block is left untouched; it is not freed or moved.
.SH NOTES
The Nightingale implementation uses a free-list based allocator with
magic numbers for heap corruption detection.
.PP
In debug builds, allocated memory is poisoned with the value 'M' and
freed memory with 'F' to aid in detecting use-after-free bugs.
.PP
The allocator automatically expands its heap using
.BR mmap (2)
when necessary.
.SH SEE ALSO
.BR mmap (2),
.BR brk (2)
